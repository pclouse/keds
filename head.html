<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TTW2P');</script>
<!-- End Google Tag Manager -->
<script type="speculationrules">
    {
        "prerender": [{
            "where": {
                "href_matches": "/*"
            },
            "eagerness": "moderate"
        }]
    }
</script>
<script type="importmap">
    {
        "imports": {
            "@dropins/tools/": "/scripts/__dropins__/tools/",
            "@dropins/storefront-pdp/": "/scripts/__dropins__/storefront-pdp/"
        }
    }
</script>

<script src="/scripts/aem.js" type="module"></script>
<script src="/scripts/scripts.js" type="module"></script>
<script src="/scripts/configs.js" type="module"></script>
<script src="/scripts/commerce.js" type="module"></script>

<link rel="modulepreload" href="/scripts/dropins.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/event-bus.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/fetch-graphql.js" />
<link rel="modulepreload" href="/scripts/__dropins__/tools/initializer.js" />

<link rel="stylesheet" href="/styles/styles.css" />

<!-- Klevu Scripts -->
<link rel="preconnect" href="https&#x3A;&#x2F;&#x2F;js.klevu.com"/>
<script type="text&#x2F;javascript">
    var klevu_lang = 'en';
    var klevu_baseCurrencyCode = 'USD';
    var klevu_currentCurrencyCode = 'USD';

    var klevu_pubIsInUse = true;
    var klevu_current_version = '3.6.3';</script>
<script type="text&#x2F;javascript" defer="true" onload="window.dispatchEvent&#x28;new&#x20;CustomEvent&#x28;&quot;klevu_script_loaded&quot;&#x29;&#x29;&#x3B;" src="https&#x3A;&#x2F;&#x2F;js.klevu.com&#x2F;core&#x2F;v2&#x2F;klevu.js"></script>

<script type="text&#x2F;javascript" id="klevu_jsapikeys">window.addEventListener('klevu_script_loaded', function() {
    klevu({"recs":{"apiKey":"klevu-165824312737915448"},"analytics":{"apiKey":"klevu-165824312737915448"},"search":{"apiKey":"klevu-165824312737915448"},"powerUp":{"catnav":false}});
});</script>
<script type="text&#x2F;javascript" id="klevu_jsdeferredpowerup">window.addEventListener('klevu_script_loaded' ,function() {
    klevu({"powerUp":{"catnav":false,"recsModule":false,"quick":false,"landing":false}});
});</script><script type="text/javascript" id="klevu_jsmodules">
    window.addEventListener('klevu_script_loaded', function() {
        // Add Price Field Suffix for customer group and currency conversion
        window.klevu_addPriceSuffixToQueryControl = {
            name: 'addPriceSuffixToQuery',
            fire: function (data, scope) {
                var customerData = JSON.parse(window.localStorage.getItem('klv_mage') || '{}').customerData || {
                    customer_group_id: 32000            };
                klevu.search.modules.addPriceSuffixToQuery(data, scope, klevu_baseCurrencyCode, customerData.customer_group_id);
            }
        };
        (function (klevu) {
            klevu.extend(true, klevu.search.modules, {
                addPriceSuffixToQuery: function (data, scope, currencyCode, customerGroupId) {
                    if (typeof data.request.current === "undefined") {
                        return false;
                    }
                    klevu.each(data.request.current.recordQueries, function (key, query) {
                        //code to fetch prices
                        klevu.setObjectPath(
                            data,
                            "localOverrides.query." + query.id + ".settings.priceFieldSuffix",
                            currencyCode + '-' + "1"
                        );
                        // set group catalog visibility
                        klevu.setObjectPath(
                            data,
                            "localOverrides.query." + query.id + ".settings.visibilityGroupID",
                            "General" // needs to be the group code, not ID
                        );
                    });
                },
                mageConvertPriceRecordCurrencyData: function (productRecords, currencyCode, currencyRates) {
                    if (!productRecords) {
                        return;
                    }
                    klevu.each(productRecords, function (recordKey, productRecord) {
                        var fromRate = parseFloat(currencyRates[productRecord.currency] || 0);
                        var toRate = parseFloat(currencyRates[currencyCode] || 0);
                        if (!fromRate || !toRate) {
                            return;
                        }
                        var exchangeRate = toRate / fromRate;
                        if (klevu.isNumeric(klevu.getObjectPath(productRecord, "price"))) {
                            productRecord.price *= exchangeRate;
                        }
                        if (klevu.isNumeric(klevu.getObjectPath(productRecord, "salePrice"))) {
                            productRecord.salePrice *= exchangeRate;
                        }
                        if (klevu.isNumeric(klevu.getObjectPath(productRecord, "startPrice"))) {
                            productRecord.startPrice *= exchangeRate;
                        }
                        productRecord.currency = currencyCode;
                    });
                }
            });
        })(klevu);
    });
</script>

<script type="text&#x2F;javascript" defer="true" src="https&#x3A;&#x2F;&#x2F;js.klevu.com&#x2F;recs&#x2F;v2&#x2F;klevu-recs.js"></script>
<script type="text&#x2F;javascript" id="klevu_jsinteractive">window.addEventListener('klevu_script_loaded' , function() {
    klevu.interactive(function () {
        var options = {"url":{"protocol":"https:","landing":"https:\/\/staging.boatoutfitters.com\/search\/","search":"https:\/\/eucs30v2.ksearchnet.com\/cs\/v2\/search"},"search":{"minChars":0,"searchBoxSelector":"input#search[type=text][name=q],.kuSearchInput"}};

        window.getCookieByName = function(name) {
            var cookie, i, cookieArr = document.cookie.split(";");
            for (i = 0; i < cookieArr.length; i++) {
                for (cookie = cookieArr[i]; " " === cookie.charAt(0); )
                    cookie = cookie.substring(1, cookie.length);
                if (0 === cookie.indexOf("form_key="))
                    return cookie.substring(9, cookie.length)
            }
            return null;
        }

// Create a variable to remember when the default limit has been set
        let limitsSet = false;
        klevu({
            powerUp: {
                landing: false,
                quick: false,
                catnav: false
            }
        });

        klevu.coreEvent.build({
            name: "setRemoteConfigLandingOverride",
            fire: function () {
                if (klevu.getSetting(klevu, "settings.flags.setRemoteConfigLanding.build") || klevu.getSetting(klevu, "settings.flags.setRemoteConfigCatnav.build")) {
                    if (klevu.getSetting(klevu, "settings.flags.setRemoteConfigLanding.build")) {
                        window.pageType = 'landing';
                        window.setRemoteConfig = 'setRemoteConfigLanding';
                    }
                    if (klevu.getSetting(klevu, "settings.flags.setRemoteConfigCatnav.build")) {
                        window.pageType = 'catnav';
                        window.setRemoteConfig = 'setRemoteConfigCatnav';
                    }
                    if (window.pageType === 'landing' || window.pageType === 'catnav') {

                        // before user leaves page, record the scroll position on the catalog pages
                        window.addEventListener("beforeunload", function() {
                            const newState = Object.assign({cataloglastScrollPosition: scrollY}, history.state)
                            history.replaceState(newState, '', location.href);
                        });

                        // when ready (after klevu has loaded on the page), scroll to the saved position
                        document.addEventListener('klevuLoaded', function() {
                            if (!history.state || typeof history.state.cataloglastScrollPosition !== 'number') {
                                return;
                            }

                            scrollTo(scrollX, history.state.cataloglastScrollPosition);

                            const cleanState = Object.assign({}, history.state)
                            delete cleanState.cataloglastScrollPosition;
                            history.replaceState(cleanState, '', location.href);
                        });

                        // disable automatic scrolling by the browser.
                        if ('scrollRestoration' in history) {
                            history.scrollRestoration = 'manual';
                        }

                    }
                    return true;
                }
                return false;
            },
            maxCount: 150,
            delay: 100
        });

        klevu.coreEvent.attach("setRemoteConfigLandingOverride", {
            name: "attachRemoteConfigLandingOverride",
            fire: function () {

                // reorder select attributes by number of alphabetically
                try {
                    klevu.search[window.pageType].getScope().chains.template.process.success.add({
                        name: "filterReorder",
                        fire: function (data, scope) {
                            klevu.each(data.template.query, function (key, query) {
                                klevu.each(query.filters, function (key, filter) {
                                    const reorderFacetsFloat = (type) => {
                                        type.sort((a, b) => {

                                            if (parseFloat(a.name) < parseFloat(b.name)) {
                                                return -1;
                                            }
                                            if (parseFloat(a.name) > parseFloat(b.name)) {
                                                return 1;
                                            }
                                            return 0;
                                        });
                                    }

                                    const reorderFacetsString = (type) => {
                                        type.sort((a, b) => {

                                            if (a.name < b.name) {
                                                return -1;
                                            }
                                            if (a.name > b.name) {
                                                return 1;
                                            }
                                            return 0;
                                        });
                                    }

                                    if (
                                        filter.key === 'product_depth_range'
                                        || filter.key === 'product_width_range'
                                        || filter.key === 'product_height_range') {
                                        reorderFacetsFloat(filter.options);
                                    }

                                    if (filter.key === 'price_group') {
                                        reorderFacetsString(filter.options)
                                    }
                                });
                            });
                        }
                    });
                } catch (error) {
                    console.log(error)
                }
            }
        });

// Create new event for category pages
        klevu.coreEvent.build({
            name: "setKlevuCatnavTemplateOverride",
            fire: function () {
                if (klevu.getGlobalSetting("flags.setRemoteConfigCatnav.build", false)) {
                    window.pageType = 'catnav';
                    window.setRemoteConfig = 'setRemoteConfigCatnav';
                    return true;
                }
                return false;
            },
            maxCount: 150,
            delay: 100
        });

// Create new event for quick search
        klevu.coreEvent.build({
            name: "setKlevuQuickTemplateFiltersOverride",
            fire: function () {
                if (klevu.getGlobalSetting("flags.setRemoteConfigQuick.build", false)) {
                    return true;
                }
                return false;
            },
            maxCount: 150,
            delay: 100
        });

// Create new event for the landing page
        klevu.coreEvent.build({
            name: "setklevuLandingTemplateOverride",
            fire: function () {
                if (klevu.getGlobalSetting("flags.setRemoteConfigLanding.build", false)) {
                    return true;
                }
                return false;
            },
            maxCount: 150,
            delay: 100
        });

// Attach the category events to klevu
        klevu.coreEvent.attach("setKlevuCatnavTemplateOverride", {
            name: "attachKlevuCatnavTemplateOverride",
            fire: function () {
                // Apply the facets supplied in the current URL string

                klevu.search.catnav.getScope().chains.request.control.addAfter("initRequest", {

                    name: "selectFiltersFromURL",

                    fire: function (data, scope) {

                        // UNCOMMENT, if you want to change default number of products
                        // klevu.each(data.request.current.recordQueries, function (key, query) {
                        //   query.settings.limit = 48;
                        // });

                        // UNCOMMENT, if you want to change default number of facet items
                        klevu.each(
                            data.request.current.recordQueries,
                            function (key, query) {
                                query.filters.filtersToReturn.options.limit = 150;
                            });
                        // Restore Search Params On Page Load

                        klevu.search.modules.addParamsToURL.base.restoreSearchParamsOnPageLoad(data, scope);

                    }

                });

                klevu.search.catnav.getScope().chains.template.events.add({

                    name: "addURLtoHistory",

                    fire: function (data, scope) {

                        // Add selected FILTERS and PAGINATION to the URL

                        klevu.search.modules.addParamsToURL.base.addURLtoHistory(data, scope);
                    }
                });
                window.onpopstate = function (event) {

                    try {

                        // passing activeQueryId because it's lost once we reset the data below

                        var activeQueryId = klevu.getObjectPath(klevu.search.catnav.getScope().element.kObject.getScope().data, "context.activeQueryId");

                        // code to get ready to reset all the data
                        var data = klevu.search.catnav.getScope().element.kObject.getScope().data;
                        var scope = klevu.search.catnav.getScope().element;
                        scope.kScope.data = scope.kObject.resetData(scope.kElem);
                        scope.kScope.data.context.keyCode = 0;
                        scope.kScope.data.context.eventObject = event;
                        scope.kScope.data.context.event = "keyUp";
                        scope.kScope.data.context.preventDefault = false;

                        // Get payload for Filters & Pagination
                        klevu.search.modules.addParamsToURL.base.updatePayloadOnPopState(data, scope, activeQueryId);

                        // Fire request, re-render results

                        klevu.event.fireChain(scope.kScope, "chains.events.keyUp", scope, scope.kScope.data, event);

                    } catch (error) {

                        console.log(error)

                    }
                };

                klevu.search.catnav.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuLandingTemplateProductBlockOverride"),
                    "productBlock",
                    true);
                klevu.search.catnav.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#landingPageProductAddToCartOverride"),
                    "landingPageProductAddToCart",
                    true);
                klevu.search.catnav.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuQuickTemplateFiltersOverride"),
                    "filters",
                    true);
                klevu.search.catnav.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuLandingTemplateInfiniteScrollDownOverride"),
                    "klevuLandingTemplateInfiniteScrollDown",
                    true);

                // attach click event to button
                klevu.search.catnav.getScope().chains.template.events.add({
                    name: "applyFilters",
                    fire: function (data, scope) {
                        var target = klevu.getSetting(
                            scope.kScope.settings,
                            "settings.search.searchBoxTarget");
                        klevu.each(klevu.dom.find("#kuFilterOpener", target), function (
                            key,
                            value) {
                            klevu.event.attach(value, "click", function (event) {
                                document
                                    .getElementsByTagName("body")[0]
                                    .classList.toggle("filter_opened");
                            });
                        });
                    }
                });
                try {
                    klevu.search.catnav
                        .getScope()
                        .template.setHelper(
                        "isScreenWidthSmaller",
                        function isScreenWidthSmaller(screenWidth) {
                            if (!screenWidth)
                                screenWidth = 768;
                            var widthOfScreen =
                                window.innerWidth ||
                                document.documentElement.clientWidth ||
                                document.body.clientWidth;
                            return widthOfScreen <= screenWidth;
                        });
                } catch (error) {
                    console.log(error);
                }

                klevu.search.catnav.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#kuFilterTagsTemplateOverride"),
                    "kuFilterTagsTemplate",
                    true);
                klevu.search.catnav.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuResultsPagePersonalizations"),
                    "results",
                    true);
                klevu.search.catnav.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuLandingTemplateResultsHeadingTitleOverride"),
                    "klevuLandingTemplateResultsHeadingTitle",
                    true);

                klevu.search.catnav.getScope().chains.events.keyUp.remove({
                    name: "scrollToTop"
                }); //Removes old keyup


                // Re-add scroll up to catnav, adjusting top to be top of product listing as we are leaving cms on the page now.
                klevu.afterTemplateRender("catnav", function (data, scope) {
                    for (const element of document.getElementsByClassName("klevuFilterOption")) {
                        element.addEventListener('click', function (e) {
                            var top = document.getElementsByClassName('category-view')[0].offsetHeight;
                            document.body.scrollTop = document.documentElement.scrollTop = top;
                        });
                    }
                });

                // trigger content updated on render of page results for ajax add to cart.
                klevu.afterTemplateRender("catnav", function (data, scope) {
                    <!--TODO-->
                    <!--            require(['catalogAddToCart', 'mage/mage', 'mage/apply/main'], function (addToCart, mage, mageApply) {-->
                    <!--                jQuery(".kuResultWrap [data-role=tocart-form] input[name=form_key]").val(window.getCookieByName('form_key'));-->
                    <!--                mageApply.apply('.kuResultWrap [data-role=tocart-form]');-->
                    <!--            });-->
                    <!---->
                    <!--            require(['jquery', 'Kadro_KlevuCustomizations/js/klevu-swatch-min-height'], function($) {-->
                    <!--                $(document).trigger('klevuLoaded');-->
                    <!--            });-->
                    document.dispatchEvent(new Event('klevuLoaded'));
                });

                // Power up the quick search functionality
                klevu({
                    powerUp: {
                        catnav: true
                    }
                });
            }
        });

// Attach the quick search events to klevu
// sets new template over klevuSearchPersonlizations
// increases suggestions returned
// overrides the klevuTemplateBase
        klevu.coreEvent.attach("setKlevuQuickTemplateFiltersOverride", {
            name: "attachKlevuQuickTemplateFiltersOverride",
            fire: function () {
                klevu.search.quick.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuQuickTemplateFiltersOverride"),
                    "filters",
                    true);

                // Override the klevuQuickProductBlock template with our own
                klevu.search.quick.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuSearchPersonalizations_cmsBlock"),
                    "klevuSearchPersonalizations",
                    true);

                // Modify the number of suggestions returned, additionally adds a filter to the query.
                klevu.search.quick.getScope().chains.request.control.addAfter("initRequest", {
                    name: "modifyQuickQuery",
                    fire: function (data, scope) {
                        klevu.search.modules.overrideSearchTerm(data, scope);
                        klevu.search.modules.filterVisibleInKlevuSearch(data, scope);
                    }
                });

                // Override the klevuQuickProductBlock template with our own
                klevu.each(klevu.search.extraSearchBox, function (key, box) {
                    box.getScope().template.setTemplate(
                        klevu.dom.helpers.getHTML("#klevuQuickTemplateBase_showPersonalizations"),
                        "klevuTemplateBase",
                        true);
                });

                klevu.settings.chains.documentClick.add({
                    name: "hideOverlay",
                    fire: function (data, scope) {

                        // Kadro edit: adding classes to ignore when the menu is open
                        var headerIgnoreSelector = ".header-content-wrapper > div:not(.logo-container)";

                        var defaultIgnoreClass = ".kuPreventDocumentClick";
                        var documentClickIgnoreSelector = klevu.getGlobalSetting("search.documentClickPreventSelector", defaultIgnoreClass);
                        if (documentClickIgnoreSelector !== defaultIgnoreClass) {
                            documentClickIgnoreSelector += "," + defaultIgnoreClass;
                        }

                        documentClickIgnoreSelector += "," + headerIgnoreSelector;

                        var parent = klevu.dom.helpers.getClosest(data.event.target, documentClickIgnoreSelector);

                        if (parent && !data.event.target.matches("button.search-close-button")) {
                            return;
                        }

                        klevu.each(klevu.search.extraSearchBox, function (key, box) {
                            var fullPage = klevu.getSetting(box.getScope().settings, "settings.search.fullPageLayoutEnabled", true);
                            if (!fullPage) {
                                var target = klevu.getSetting(box.getScope().settings, "settings.search.searchBoxTarget");
                                target.style = "display: none !important;";
                                var header = document.querySelector("header.page-header");
                                header.classList.remove("search-overlay");
                                var wrapper = document.querySelector(".page-wrapper");
                                wrapper.classList.remove("search-overlay-active");
                                var body = document.querySelector("body#html-body");
                                body.classList.remove("search-open");
                                var overlay = document.querySelector(".klevu-overlay");
                                overlay.style = "display: none;";
                            }
                        });
                    }
                });

                // modified to always allow popular search terms
                var isPopularSearchEnabled = klevu.search.modules.kmcInputs.base.getShowPopularSearchesValue();
                if (!isPopularSearchEnabled) {
                    return;
                }

                klevu.each(klevu.search.extraSearchBox, function (key, box) {

                    box.getScope().template.setTemplate(klevu.dom.helpers.getHTML("#kuTemplatePopularSearches"), "kuTemplatePopularSearches", true);

                    /**
                     * Event to add popular searches data into the data template object
                     */
                    box.getScope().chains.template.process.success.add({
                        name: "addPopularSearchData",
                        fire: function (data, scope) {
                            // kadro: removed if/else so this always runs
                            data.template.popularSearches = klevu.search.modules.kmcInputs.base.getWebstorePopularTermsValue();
                        }
                    });

                    /**
                     * Event to bind popular searches element click event
                     */
                    box.getScope().chains.template.events.add({
                        name: "attachPopularSearchUIEvents",
                        fire: function (data, scope) {
                            var target = klevu.getSetting(scope.kScope.settings, "settings.search.searchBoxTarget");
                            klevu.each(klevu.dom.find(".kuPopularSearchTerm", target), function (key, element) {
                                klevu.event.attach(element, "click", function (event) {
                                    var termValue = element.dataset.value;
                                    if (termValue) {
                                        scope.kElem.value = termValue;
                                        var target = klevu.dom.helpers.getClosest(element, ".klevuTarget");
                                        if (target) {
                                            var elScope = target.kElem;
                                            elScope.kScope.data = elScope.kObject.resetData(elScope.kElem);
                                            elScope.kScope.data.context.keyCode = 0;
                                            elScope.kScope.data.context.eventObject = event;
                                            elScope.kScope.data.context.event = "keyUp";
                                            elScope.kScope.data.context.preventDefault = false;
                                            klevu.event.fireChain(elScope.kScope, "chains.events.keyUp", elScope, elScope.kScope.data, event);
                                        }
                                    }
                                });
                            });
                        }
                    });

                    box.getScope().chains.events.focus.add({
                        name: "hideAllOverlay",
                        fire: function (data, scope) {
                            klevu.each(klevu.search.extraSearchBox, function (key, box) {
                                var fullPage = klevu.getSetting(box.getScope().settings, "settings.search.fullPageLayoutEnabled", true);
                                if (!fullPage) {
                                    var target = klevu.getSetting(box.getScope().settings, "settings.search.searchBoxTarget");
                                    target.style = "display: none !important;";
                                    var header = document.querySelector("header.page-header");
                                    header.classList.remove("search-overlay");
                                    var wrapper = document.querySelector(".page-wrapper");
                                    wrapper.classList.remove("search-overlay-active");
                                    var body = document.querySelector("body#html-body");
                                    body.classList.remove("search-open");
                                    var overlay = document.querySelector(".klevu-overlay");
                                    overlay.style = "display: none;";
                                }
                            });
                        }
                    });

                    box.getScope().chains.events.focus.add({
                        name: "displayOverlay",
                        fire: function (data, scope) {
                            var target = klevu.getSetting(scope.kScope.settings, "settings.search.searchBoxTarget");
                            target.style = "display: block !important;";
                            var header = document.querySelector("header.page-header");
                            header.classList.add("search-overlay");
                            var wrapper = document.querySelector(".page-wrapper");
                            wrapper.classList.add("search-overlay-active");
                            var body = document.querySelector("body#html-body");
                            body.classList.add("search-open");
                            var overlay = document.querySelector(".klevu-overlay");
                            overlay.style = "display: block;";
                        }
                    });

                    // where to position the template
                    box.getScope().chains.template.events.add({
                        name: "positionTemplate",
                        fire: function (data, scope) {
                            var position,
                                leftPosition,
                                topPosition,
                                searchBoxWidth,
                                searchBoxHeight,
                                screenWidth,
                                minLtrWidth,
                                halfScreen;

                            var getScreenWidth = function () {
                                var doc = document,
                                    docBody = doc.body,
                                    docElem = doc.documentElement,
                                    win = window,
                                    viewportWidth,
                                    viewportHeight;

                                // the more standards compliant browsers
                                // (mozilla/netscape/opera/IE7) use window.innerWidth and window.innerHeight
                                if (typeof(docBody.clientWidth) == 'number') {
                                    viewportWidth = docBody.clientWidth;
                                } else if (typeof win.innerWidth !== 'undefined') {
                                    viewportWidth = win.innerWidth;
                                } else if (typeof docElem != 'undefined' &&
                                    typeof docElem.clientWidth != 'undefined' &&
                                    docElem.clientWidth != 0) {
                                    // IE6 in standards compliant mode
                                    // (i.e. with a valid doctype as the first line in the document)
                                    viewportWidth = docElem.clientWidth;
                                } else {
                                    // older versions of IE
                                    viewportWidth = doc.getElementsByTagName('body')[0].clientWidth
                                }
                                return viewportWidth;
                            };

                            var getSearchBoxPosition = function (searchBox) {
                                var _x = 0,
                                    _y = 0,
                                    currEl = searchBox,
                                    style,
                                    position,
                                    doc = document,
                                    body = doc.body,
                                    fixedPosition = false,
                                    oldOffsetTop = 0,
                                    win = window;
                                while (currEl && currEl.tagName.toLowerCase() !== 'body') {
                                    if (!win.getComputedStyle) {
                                        win.getComputedStyle = function (searchBox, pseudo) {
                                            this.searchBox = searchBox;
                                            this.getPropertyValue = function (prop) {
                                                var re = /(\-([a-z]){1})/g;
                                                if (prop === 'float') {
                                                    prop = 'styleFloat';
                                                }
                                                if (re.test(prop)) {
                                                    prop = prop.replace(re, function () {
                                                        return arguments[2].toUpperCase();
                                                    });
                                                }
                                                return searchBox.currentStyle[prop] ? searchBox.currentStyle[prop] : null;
                                            }
                                            return this;
                                        }
                                    }
                                    style = win.getComputedStyle(currEl, null);
                                    if (style) {
                                        position = style.getPropertyValue('position');
                                        if (position === 'fixed') {
                                            fixedPosition = true;
                                            break;
                                        } else {
                                            currEl = currEl.parentNode;
                                        }
                                    } else {
                                        currEl = currEl.parentNode;
                                    }
                                }
                                var change = 1,
                                    scrollTop = (win.pageYOffset !== undefined) ? win.pageYOffset :
                                        (doc.documentElement || body.parentNode || body).scrollTop;
                                while (searchBox && !isNaN(searchBox.offsetLeft) &&
                                !isNaN(searchBox.offsetTop)) {
                                    _x += searchBox.offsetLeft - searchBox.scrollLeft;
                                    if (fixedPosition && change === 1) {
                                        _y += searchBox.offsetTop + scrollTop;
                                        change = 0;
                                    } else {
                                        _y += searchBox.offsetTop;
                                    }
                                    searchBox = searchBox.offsetParent;
                                }
                                return {
                                    top: _y,
                                    left: _x
                                };
                            };

                            screenWidth = getScreenWidth();
                            position = getSearchBoxPosition(scope.kElem);

                            topPosition = position.top;
                            leftPosition = position.left;
                            searchBoxWidth = scope.kElem.offsetWidth;
                            searchBoxHeight = scope.kElem.offsetHeight;

                            halfScreen = screenWidth / 2;
                            minLtrWidth = searchBoxWidth;

                            // Kadro edit, added 5 px to position of overlay
                            divTop = searchBoxHeight + topPosition + 5 + 'px';
                            if (leftPosition >= halfScreen) {
                                divRight = screenWidth - (leftPosition + searchBoxWidth) + 'px';
                                divLeft = 'auto';
                            } else {
                                divRight = 'auto';
                                divLeft = leftPosition + 'px';
                            }

                            var target = klevu.getSetting(scope.kScope.settings, "settings.search.searchBoxTarget");
                            klevu.dom.find(".klevuWrap", target)[0].style = "top:" + divTop + ";left: " + divLeft + ";right: " + divRight + ";";
                        }
                    });
                });

                // Power up the quick search functionality
                klevu({
                    powerUp: {
                        quick: true
                    }
                });
            }
        });

// Attach the landing page events to klevu
        klevu.coreEvent.attach("setklevuLandingTemplateOverride", {
            name: "attachklevuLandingTemplateProductBlockOverride",
            fire: function () {
                klevu.search.landing.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuLandingTemplateProductBlockOverride"),
                    "productBlock",
                    true);
                klevu.search.landing.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#landingPageProductAddToCartOverride"),
                    "landingPageProductAddToCart",
                    true);
                klevu.search.landing.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuLandingTemplateFiltersOverride"),
                    "filters",
                    true);

                klevu.search.landing.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuLandingTemplateInfiniteScrollDownOverride"),
                    "klevuLandingTemplateInfiniteScrollDown",
                    true);

                klevu.search.landing.getScope().chains.events.keyUp.remove({
                    name: "scrollToTop"
                });


                // modifies the query for the search result landing page
                klevu.search.landing.getScope().chains.request.control.addAfter("initRequest", {
                    name: "modifyLandingQuery",
                    fire: function (data, scope) {
                        klevu.search.modules.filterVisibleInKlevuSearch(data, scope);
                    }
                });


                // attach click event to button
                klevu.search.landing.getScope().chains.template.events.add({
                    name: "applyFilters",
                    fire: function (data, scope) {
                        var target = klevu.getSetting(
                            scope.kScope.settings,
                            "settings.search.searchBoxTarget");
                        klevu.each(klevu.dom.find("#kuFilterOpener", target), function (
                            key,
                            value) {
                            klevu.event.attach(value, "click", function (event) {
                                document
                                    .getElementsByTagName("body")[0]
                                    .classList.toggle("filter_opened");
                            });
                        });
                    }
                });
                try {
                    klevu.search.landing
                        .getScope()
                        .template.setHelper(
                        "isScreenWidthSmaller",
                        function isScreenWidthSmaller(screenWidth) {
                            if (!screenWidth)
                                screenWidth = 768;
                            var widthOfScreen =
                                window.innerWidth ||
                                document.documentElement.clientWidth ||
                                document.body.clientWidth;
                            return widthOfScreen <= screenWidth;
                        });
                } catch (error) {
                    console.log(error);
                }

                klevu.search.landing.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#kuFilterTagsTemplateOverride"),
                    "kuFilterTagsTemplate",
                    true);


                klevu.search.landing.getScope().chains.request.build.add({
                    name: "setLimitsOverride",
                    fire: function (data, scope) {
                        //Wait until relevant data has loaded
                        if (!data.request.current.recordQueries.length) {
                            return false;
                        }

                        var landingStorage = klevu.getSetting(scope.kScope.settings, "settings.storage");

                        //Overwrite default page limit values to 24
                        klevu.each(data.request.current.recordQueries, function (key, query) {

                            if(typeof landingStorage.limits === 'undefined' || !landingStorage.limits) {
                                return;
                            }
                            var limit = (landingStorage.limits.getElement(query.id) == query.id) ? false : landingStorage.limits.getElement(query.id);

                            // If the limits haven't been set, set them
                            if (!limitsSet) {
                                query.settings.limit = 24;
                                landingStorage.limits.addElement(query.id, 24);
                                landingStorage.limits.mergeToGlobal();
                                limitsSet = true;
                            }

                            if (limit) {
                                query.settings.limit = limit;
                            } else {
                                query.settings.limit = 24;
                                landingStorage.limits.addElement(query.id, 24);
                                landingStorage.limits.mergeToGlobal();
                            }
                        });

                    }
                });

                klevu.search.landing.getScope().template.setTemplate(
                    klevu.dom.helpers.getHTML("#klevuResultsPagePersonalizations"),
                    "results",
                    true);

                // trigger content updated on render of page results for ajax add to cart.
                klevu.afterTemplateRender("landing", function (data, scope) {
                    <!--TODO-->
                    <!--            require(['catalogAddToCart', 'mage/mage', 'mage/apply/main'], function (addToCart, mage, mageApply) {-->
                    <!--                jQuery(".kuResultWrap [data-role=tocart-form] input[name=form_key]").val(window.getCookieByName('form_key'));-->
                    <!--                mageApply.apply('.kuResultWrap [data-role=tocart-form]');-->
                    <!--            });-->
                    <!---->
                    <!--            require(['jquery','Kadro_KlevuCustomizations/js/klevu-swatch-min-height'], function($) {-->
                    <!--                $(document).trigger('klevuLoaded');-->
                    <!--            })-->
                    document.dispatchEvent(new Event('klevuLoaded'));
                });

                // Power up the landing search functionality
                klevu({
                    powerUp: {
                        landing: true
                    }
                });

            }
        });

        klevu.modifyRequest(
            "landing",
            "productList.filters.filtersToReturn.options.limit",
            150);
// Add methods used in custom event, increases the max number of suggestions.
        (function (klevu) {
            klevu.extend(true, klevu.search.modules, {
                overrideSearchTerm: function (data, scope) {
                    klevu.each(data.request.current.recordQueries, function (key, query) {
                        klevu.setObjectPath(
                            data,
                            "localOverrides.query." + query.id + ".settings.limit",
                            5 // The maximum number of suggestions to be returned
                        );
                    });
                }
            });
        })(klevu);

        /**
         * adds a filter to include in results products that have a true "visible_in_klevu_search" attribute.
         */
        (function (klevu) {
            klevu.extend(true, klevu.search.modules, {
                filterVisibleInKlevuSearch: function (data, scope, queryId) {
                    var activeQueryId = klevu.getObjectPath(data, "context.activeQueryId");

                    if (queryId && queryId.length) {
                        activeQueryId = queryId;
                    }
                    var applyFilters = klevu.getObjectPath(data, "localOverrides.query." + activeQueryId + ".filters.applyFilters.filters")
                    if (applyFilters) {
                        applyFilters.push({
                            key: "visible_in_klevu_search",
                            values: ["Yes"]
                        });
                    } else {
                        klevu.setObjectPath(data, "localOverrides.query." + activeQueryId + ".filters.applyFilters.filters", [{
                            key: "visible_in_klevu_search",
                            values: ["Yes"]
                        }
                        ]);
                    }
                }
            });
        })(klevu);

// filters & pagination to URL
        (function (klevu) {
            klevu.extend(true, klevu.search.modules, {
                addParamsToURL: {
                    base: {
                        addURLtoHistory: function (data, scope, queryId) {
                            // Global stuff
                            if (typeof window.history === "undefined" || typeof window.history.pushState === "undefined") {
                                console.error("This browser does not have the support of window.history or window.history.pushState");
                                return;
                            }

                            var searchPath = new URLSearchParams(window.location.search);
                            var currentSearchPath;
                            var previousSearchPath = searchPath.toString();

                            // this is in case we're running our code where we dont have context.activeQueryId
                            var activeQueryId = klevu.getObjectPath(data, "context.activeQueryId");
                            if (queryId && queryId.length) {
                                activeQueryId = queryId;
                            }

                            // Check if there any filter selected
                            let applyFilters = typeof data.localOverrides.query[activeQueryId].filters !== 'undefined' ? data.localOverrides.query[activeQueryId].filters.applyFilters : {};
                            let isThereFiltersSelected = false;
                            // Check if applyFilters is an object (but not an array), and not empty
                            if (typeof applyFilters === 'object' && !Array.isArray(applyFilters) && applyFilters !== null && Object.keys(applyFilters).length > 0) {
                                isThereFiltersSelected = true;
                            }

                            // PAGINATION TO URL
                            var hasPaginationEnabled = klevu.getSetting(klevu, "settings.theme.modules.pagination.searchResultsPage.enable");
                            var paginationQueryParam = "Page";
                            var currentPage = 0;

                            if (hasPaginationEnabled) {
                                var activeQueryMeta = klevu.getObjectPath(data, "template.query." + activeQueryId + ".meta");
                                if (activeQueryMeta) {
                                    var productListLimit = activeQueryMeta.noOfResults;
                                    currentPage = Math.ceil(activeQueryMeta.offset / productListLimit) + 1;
                                }

                                if (currentPage === 0 || currentPage === 1) {
                                    searchPath.delete(paginationQueryParam);
                                } else {
                                    searchPath.set(paginationQueryParam, currentPage);
                                }

                                currentSearchPath = searchPath.toString();
                            };

                            // FILTERS TO URL
                            var activeQueryFilters = klevu.getObjectPath(data, "template.query." + activeQueryId + ".filters");
                            var filterValuesQueryParam = "";

                            if (activeQueryFilters) {
                                klevu.each(activeQueryFilters, function (key, filter) {
                                    var selectedFilterKeyString = "";
                                    var filterOptions = filter.options;
                                    var selectedValues = "";

                                    if (filterOptions && filterOptions.length) {
                                        klevu.each(filterOptions, function (key, option) {
                                            if (option.selected === true) {
                                                if (selectedValues.length) {
                                                    selectedValues += ",";
                                                }
                                                selectedValues += option.value;
                                            }
                                        });
                                    } else if (filter.type === "SLIDER") {
                                        var startValue = filter.start;
                                        var endValue = filter.end;
                                        var minValue = filter.min;
                                        var maxValue = filter.max;
                                        if (typeof startValue !== "undefined" && startValue !== null && typeof endValue !== "undefined" && endValue !== null) {
                                            if (Number(startValue) === Number(minValue) && Number(endValue) === Number(maxValue)) {
                                                // just skipping
                                            } else {
                                                selectedValues = startValue + "-" + endValue;
                                            }
                                        }
                                    }

                                    if (selectedValues.length) {
                                        // selectedFilterKeyString += filter.key + ":" + selectedValues;
                                        selectedFilterKeyString += encodeURIComponent(filter.key) + ":" + encodeURIComponent(selectedValues);
                                    }

                                    if (selectedFilterKeyString.length) {
                                        if (filterValuesQueryParam.length) {
                                            filterValuesQueryParam += ";";
                                        }
                                        filterValuesQueryParam += selectedFilterKeyString;
                                    }
                                });
                            }

                            if (filterValuesQueryParam.length > 0 && isThereFiltersSelected) {
                                searchPath.set("Filters", filterValuesQueryParam);
                            } else {
                                searchPath.delete("Filters");
                            }

                            currentSearchPath = searchPath.toString();

                            // ==============================
                            // Final URL change
                            if (previousSearchPath !== currentSearchPath) {
                                //Hides the category cms content on pagination/filters after inital load
                                if (isThereFiltersSelected) {
                                    document.getElementsByTagName('body')[0].classList.add("catalog-category-filters");
                                } else {
                                    document.getElementsByTagName('body')[0].classList.remove("catalog-category-filters");
                                }
                                if (currentPage > 1) {
                                    document.getElementsByTagName('body')[0].classList.add("catalog-category-pagination");
                                } else {
                                    document.getElementsByTagName('body')[0].classList.remove("catalog-category-pagination");
                                }

                                var historyState = {
                                    page: currentPage,
                                    filters: currentSearchPath
                                };
                                window.history.pushState(historyState, null, currentSearchPath ? '?' + currentSearchPath : window.location.pathname);
                            }
                        },

                        restoreSearchParamsOnPageLoad: function (data, scope) {
                            var hasAlreadyTriggered = klevu.getObjectPath(scope.kScope, "element.kScope.getAndUpdateFiltersTriggered");
                            if (hasAlreadyTriggered)
                                return;

                            // var activeQueryId = klevu.getObjectPath(data, "context.activeQueryId");
                            var activeQueryId = "productList";
                            var filtersFromURL = klevu.dom.helpers.getQueryStringValue("Filters");
                            var paginationFromURL = klevu.dom.helpers.getQueryStringValue("Page");

                            var matchedQueryParamId = "";
                            var matchedQueryParamValue = "";
                            var recordQueries = klevu.getObjectPath(data, "request.current.recordQueries");

                            if (recordQueries && recordQueries.length) {
                                klevu.each(recordQueries, function (key, recordQuery) {
                                    if (recordQuery.id) {
                                        if ((paginationFromURL && paginationFromURL.length) || (filtersFromURL && filtersFromURL.length)) {
                                            matchedQueryParamId = recordQuery.id;
                                            matchedQueryParamValue = paginationFromURL || filtersFromURL;
                                        }
                                    }
                                });
                            }

                            klevu.setObjectPath(scope.kScope, "element.kScope.getAndUpdateFiltersTriggered", true);

                            matchedQueryParamId = "productList";

                            if (matchedQueryParamId.length && matchedQueryParamValue.length) {
                                activeQueryId = matchedQueryParamId;
                                var storage = klevu.getSetting(scope.kScope.settings, "settings.storage");
                                if (storage.tabs) {
                                    storage.tabs.setStorage("local");
                                    storage.tabs.mergeFromGlobal();
                                    storage.tabs.addElement("active", activeQueryId);
                                    storage.tabs.mergeToGlobal();
                                }
                            }

                            if (paginationFromURL && paginationFromURL > 1) {
                                if (recordQueries && recordQueries.length) {
                                    klevu.each(recordQueries, function (key, recordQuery) {
                                        if (recordQuery.id === activeQueryId) {
                                            var limit = klevu.getObjectPath(recordQuery, "settings.limit");
                                            limit = Number(limit);
                                            if (limit > 0) {
                                                var expectedOffset = (paginationFromURL - 1) * limit;
                                                klevu.setObjectPath(data, "localOverrides.query." + activeQueryId + ".settings.offset", expectedOffset);
                                            }
                                        }
                                    });
                                }
                            }

                            // FILTERS
                            if (filtersFromURL && filtersFromURL.length) {
                                var facets = filtersFromURL.split(";");
                                if (facets) {
                                    klevu.each(facets, function (key, facet) {
                                        var splitFacet = facet.split(":");
                                        if (splitFacet.length) {
                                            var facetKey = decodeURIComponent(splitFacet[0]);
                                            var facetValues = decodeURIComponent(splitFacet[1]).split(",");
                                            var applyFilters = klevu.getObjectPath(data, "localOverrides.query." + activeQueryId + ".filters.applyFilters.filters");

                                            if (applyFilters && applyFilters.length) { // if there're some filters
                                                var isExistingKey = false;
                                                klevu.each(applyFilters, function (key, applyFilter) {
                                                    if (applyFilter.key === facetKey) {
                                                        isExistingKey = true;
                                                        klevu.each(facetValues, function (key, facetValue) {
                                                            var isFilterOptionMatched = false;
                                                            klevu.each(applyFilter.values, function (key, value) {
                                                                if (facetValue === value) {
                                                                    isFilterOptionMatched = true;
                                                                }
                                                            });
                                                            if (!isFilterOptionMatched) {
                                                                applyFilter.values.push(facetValue);
                                                            }
                                                        });
                                                    }
                                                });
                                                if (!isExistingKey) {
                                                    applyFilters.push({
                                                        key: facetKey,
                                                        values: facetValues
                                                    });
                                                }
                                            } else {
                                                klevu.setObjectPath(data, "localOverrides.query." + activeQueryId + ".filters.applyFilters.filters", [{
                                                    key: facetKey,
                                                    values: facetValues
                                                }
                                                ]);
                                            }

                                        }
                                    });
                                }
                            }
                        },

                        updatePayloadOnPopState: function (data, scope, activeQueryId) {
                            // SET PAGINATION PAYLOAD
                            var paginationFromURL = klevu.dom.helpers.getQueryStringValue("Page");
                            paginationFromURL = Number(paginationFromURL);
                            var limit = klevu.search.catnav.getScope().element.kObject.getScope().data.request.original.queryRequest[0].settings.limit;
                            limit = Number(limit);
                            if (limit > 0) {
                                var expectedOffset = ((paginationFromURL - 1) * limit) > 0 ? ((paginationFromURL - 1) * limit) : 0;
                                klevu.setObjectPath(data, "localOverrides.query." + activeQueryId + ".settings.offset", expectedOffset);
                                // klevu.search.modules.addParamsToURL.base.backBtnCounter.backBtn = 0;
                            }

                            // SET FILTER PAYLOAD
                            var filtersFromURL = klevu.dom.helpers.getQueryStringValue("Filters");
                            if (filtersFromURL && filtersFromURL.length) {
                                var facets = filtersFromURL.split(";");
                                // loop through all facets to get its values
                                let facetKey = '';
                                let facetValues = [];
                                let facetsArray = [];

                                klevu.each(facets, function (key, facet) {
                                    var splitFacet = facet.split(":");
                                    if (splitFacet.length) {
                                        facetKey = decodeURIComponent(splitFacet[0]);
                                        facetValues = decodeURIComponent(splitFacet[1]).split(",");
                                        facetsArray.push({
                                            key: facetKey,
                                            values: facetValues
                                        });
                                    }
                                });
                                // set the payload with correct filters:
                                klevu.setObjectPath(data, "localOverrides.query." + activeQueryId + ".filters.applyFilters.filters", facetsArray);
                            } else { // reset filters if Back button pressed, and there's no filters
                                klevu.setObjectPath(data, "localOverrides.query." + activeQueryId + ".filters.applyFilters.filters", []);
                            }
                        }
                    },
                    build: true
                }
            });
        })(klevu);
        let searchContentElement = document.getElementById("search-content");
        if (searchContentElement) {
            let klevuSearchResults_wrapper = document.createElement("div");
            klevuSearchResults_wrapper.id = "klevuSearchResults_wrapper";
            klevuSearchResults_wrapper.className = "klevuSearchResults_wrapper";

            let klevuSearchResults = document.createElement("div");
            klevuSearchResults.id = "klevuSearchResults";
            klevuSearchResults.className = "klevuSearchResults";

            klevuSearchResults_wrapper.appendChild(klevuSearchResults);
            searchContentElement.appendChild(klevuSearchResults_wrapper);

            options.search.searchBoxTarget = klevuSearchResults;
        }
// Magento image path needs to be updated if pubIsInUse
        klevu.coreEvent.attach("setRemoteConfigRecsBaseUpdates", {
            name: "klevuMagentoImage",
            fire: function () {
                klevu.recs.base.getScope().chains.search.control.add({
                    name: "klevuMagentoImage",
                    fire: function (data, scope) {
                        scope.recsScope.searchObject.getScope().chains.template.process.success.add({
                            name: "klevuMagentoImage",
                            fire: function (data, scope) {
                                if (typeof window.klevu_pubIsInUse == "undefined") {
                                    window.klevu_pubIsInUse = true;
                                }
                                klevu.each(data.template.query, function (key, query) {
                                    if (query.result.length > 0) {
                                        klevu.each(query.result, function (key, product) {
                                            if (window.klevu_pubIsInUse) {
                                                product.image = product.image.replace('pub/', '');
                                                product.image = product.image.replace('needtochange/', '');
                                            } else {
                                                product.image = product.image.replace('needtochange/', 'pub/');
                                            }
                                        });
                                    }
                                });
                            }
                        });
                    }
                });
            }
        });


        klevu(options);

    });
});</script><script type="text&#x2F;javascript">window.addEventListener('klevu_script_loaded', function() {
    klevu.settings.chains.initChain.add({
        name: "addPriceSuffixToRecsQuery",
        fire: function (data) {
            if (klevu.getObjectPath(klevu.recs, "base", false)
                && klevu.getGlobalSetting("flags.addPriceSuffixToQuery.recsModule", false)
                && typeof window.klevu_addPriceSuffixToQueryControl === "object"
            ) {
                klevu.search.base.getScope().chains.request.control.addAfter('initRequest', window.klevu_addPriceSuffixToQueryControl);
                klevu.setObjectPath(data, "flags.addPriceSuffixToQuery.recsModule", false);
            }
        }
    });
});

document.addEventListener('klevu.customerData.loadError', function () {
    klevu({ powerUp: { recsModule: true }});
});
document.addEventListener('klevu.customerData.loaded', function () {
    klevu({
        powerUp: {
            recsModule: true
        },
        flags: {
            addPriceSuffixToQuery: {
                recsModule: true
            }
        }
    });
});
</script>
<script type="template/klevu" id="klevuLandingTemplateInfiniteScrollDownOverride">
    <div class="kuInfiniteScrollContainer">
        <%
        var visibleProducts = data.query.productList.result.length;
        var totalProducts = data.query.productList.meta.totalResultsFound;
        %>
        <div class="kuResultCount">Showing <%= visibleProducts %> of <%= totalProducts %></div>
        <button class="kuLoadMoreBtn">View More Products</button>
    </div>
</script>

<script type="template/klevu" id="klevuLandingTemplateResultsHeadingTitleOverride">
    <div class="kuResultsHeadingTitleContainer">
        <strong class="kuResultsNumber"><%=data.query.productList.meta.totalResultsFound%></strong> Results
    </div>
</script>
<script type="template/klevu" id="landingPageProductAddToCartOverride">
    <% var link = "javascript:void(0)"; %>
    <% var btnClass = "kuLandingAddToCartBtn"; %>
    <% if (dataLocal.out_of_stock_override === 'Yes') { %>
    <div class="kuAddtocart">
        <a href="<%= dataLocal.url %>" class="view-product-link">View Product</a>
    </div>
    <% } else { %>
    <% if(dataLocal.inStock != "no") { %>
    <%
    var addToCartCaption = klevu.search.modules.kmcInputs.base.getAddToCartButtonCaption();
    var sku = dataLocal.sku;
    var action = "https://staging.boatoutfitters.com/checkout/cart/add/";
    var id = dataLocal.id.split("-")[0];
    %>

    <% if (dataLocal.isCustomOptionsAvailable == "yes") { %>
    <% addToCartCaption = "Select Options" %>
    <div class="kuAddtocart" data-id="<%=dataLocal.id%>">
        <a target="_self" href="<%= dataLocal.url %>" class="kuBtn primary action" role="button" tabindex="0" area-label="Add to cart"><%= addToCartCaption %></a>
    </div>
    <% } else { %>
    <div class="kuAddtocart" data-id="<%=dataLocal.id%>"> <a target="_self" href="javascript:void(0)" class="kuBtn primary kuLandingAddToCartBtn <%= addToCartCaption && addToCartCaption.indexOf('<img') !== -1 ? 'kuBtnDark' : '' %>" role="button" tabindex="0" area-label="Add to Cart"><%= addToCartCaption %></a> </div>
    <% } %>
    <% } %>
    <% } %>
</script>

<script type="template/klevu" id="klevuLandingTemplateFiltersOverride">
    <% if(data.query[dataLocal].filters.length > 0 ) { %>
    <button id="kuFilterOpener">Filter<span class="filter-icon ml-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="text-white px-1 rotate-0" width="24" height="24" role="img">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
<title>chevron-down</title></svg>
</span></button>
    <div class="kuFilters" role="navigation" data-position="left" aria-label="Product Filters" tabindex="0">
        <h3 class="kuFiltersTitleHeading"><%=helper.translate("Narrow by")%></h3>
        <% helper.each(data.query[dataLocal].filters,function(key,filter){ %>
        <% if(!["json_swatch_config", "show_swatches_on_plp"].includes(filter.key)){ %>
        <% if(filter.type == "OPTIONS" && filter.key !== "visible_in_klevu_search"){ %>
        <% if(filter.key == "product_depth_layerednav" || filter.key == "product_width_layerednav" || filter.key == "product_height_layerednav") {
        filter.options.sort((a,b) => { return a.value - b.value});
        } %>
        <div class="kuFilterBox klevuFilter <%=(filter.multiselect)?'kuMulticheck':''%>" data-filter="<%=filter.key%>" <% if(filter.multiselect){ %> data-singleselect="false" <% } else { %> data-singleselect="true"<% } %>>
        <div class="kuFilterHead <%=(filter.isCollapsed) ? 'kuExpand' : 'kuCollapse'%>">
            <% var filter_label = (filter.label=="klevu_price") ? "price" : filter.label; %>
            <%=helper.translate(filter_label)%>
        </div>
        <div data-optionCount="<%= filter.options.length %>" class="kuFilterNames <%= (filter.options.length <= 5 ) ? 'kuFilterShowAll': '' %> <%=(filter.isCollapsed) ? 'kuFilterCollapse' : ''%>">
            <ul>
                <% helper.each(filter.options,function(key,filterOption){ %>
                <li <% if(filterOption.selected ==true) { %> class="kuSelected"<% } %>>
                <a
                        target="_self"
                        href="#"
                <% if(filter.key == "product_depth_layerednav" || filter.key == "product_width_layerednav" || filter.key == "product_height_layerednav") { %>
                title="<%=helper.escapeHTML(Number.parseFloat(filterOption.name) + "\"")%>"
                <% } else { %>
                title="<%=helper.escapeHTML(filterOption.name)%>"
                <% } %>

                class="klevuFilterOption<% if(filterOption.selected ==true) { %> klevuFilterOptionActive<% } %>"
                data-value="<%=helper.escapeHTML(filterOption.value)%>"
                data-name="<%=helper.escapeHTML(filterOption.name)%>"
                >
                <span class="kuFilterIcon"></span>
                <% if(filter.key == "product_depth_layerednav" || filter.key == "product_width_layerednav" || filter.key == "product_height_layerednav") { %>
                <span class="kufacet-text"><%=Number.parseFloat(filterOption.name)%>"</span>
                <% } else { %>
                <span class="kufacet-text"><%=filterOption.name%></span>
                <% } %>
                <% if(filterOption.selected ==true) { %>
                <span class="kuFilterCancel">X</span>
                <% } else { %>
                <span class="kuFilterTotal"><%=filterOption.count%></span>
                <% } %>
                </a>
                </li>

                <%  }); %>
            </ul>
            <% if(filter.options.length > 5 ) { %>
            <div class="kuShowOpt" tabindex="-1">
                <span class="kuFilterDot"></span><span class="kuFilterDot"></span><span class="kuFilterDot"></span>
            </div>
            <% } %>
        </div>
    </div>
    <% } else if(filter.type == "SLIDER")  { %>
    <div class="kuFilterBox klevuFilter" data-filter="<%=filter.key%>">
        <div class="kuFilterHead <%=(filter.isCollapsed) ? 'kuExpand' : 'kuCollapse'%>">
            <% var filter_label = (filter.label=="klevu_price") ? "price" : filter.label; %>
            <%=helper.translate(filter_label)%>
        </div>
        <div class="kuFilterNames sliderFilterNames <%=(filter.isCollapsed) ? 'kuFilterCollapse' : ''%>">
            <div class="kuPriceSlider klevuSliderFilter" data-query = "<%=dataLocal%>">
                <div data-querykey = "<%=dataLocal%>" class="noUi-target noUi-ltr noUi-horizontal noUi-background kuSliderFilter kuPriceRangeSliderFilter<%=dataLocal%>"></div>
            </div>
        </div>
    </div>
    <% } else if (filter.type == "RATING")  { %>
    <div class="kuFilterBox klevuFilter <%=(filter.multiselect)?'kuMulticheck':''%>" data-filter="<%=filter.key%>" <% if(filter.multiselect){ %> data-singleselect="false" <% } else { %> data-singleselect="true"<% } %>>
    <div class="kuFilterHead <%=(filter.isCollapsed) ? 'kuExpand' : 'kuCollapse'%>">
        <%=helper.translate(filter.label)%>
    </div>
    <div data-optionCount="<%= filter.options.length %>" class="kuFilterNames <%= (filter.options.length <= 5 ) ? 'kuFilterShowAll': '' %> <%=(filter.isCollapsed) ? 'kuFilterCollapse' : ''%>">
        <ul>
            <% helper.each(filter.options,function(key,filterOption){ %>
            <li <% if(filterOption.selected ==true) { %> class="kuSelected"<% } %>>
            <a
                    target="_self"
                    href="#"
                    title="<%=helper.escapeHTML(filterOption.name)%>"
                    class="klevuFilterOption<% if(filterOption.selected ==true) { %> klevuFilterOptionActive<% } %>"
                    data-value="<%=helper.escapeHTML(filterOption.value)%>"
                    data-name="<%=helper.escapeHTML(filterOption.name)%>"
            >
                <span class="kuFilterIcon"></span>
                <span class="kufacet-text">
                                                <div class="klevuFacetStars">
                                                    <div class="klevuFacetRating" style="width:<%=(20*Number(filterOption.name))%>%;"></div>
                                                </div>
                                            </span>
                <% if(filterOption.selected ==true) { %>
                <span class="kuFilterCancel">X</span>
                <% } else { %>
                <span class="kuFilterTotal"><%=filterOption.count%></span>
                <% } %>
            </a>
            </li>

            <%  }); %>
        </ul>
    </div>
    </div>
    <% } else { %>
    <!-- Other Facets -->
    <% } %>
    <% } %>
    <% }); %>

    <!-- <div class="kuFiltersFooter">
        <a target="_self" href="javascript:void(0)" class="kuBtn kuFacetsSlideOut kuMobileFilterCloseBtn" role="button" tabindex="0" area-label=""><%=helper.translate("Close")%></a>
      </div> -->


    </div>
    <% } %>
</script>

<script type="template/klevu" id="kuFilterTagsTemplateOverride">
    <%
    var filterTagsModule = data.filterTags;
    var filterTagsData = [];
    if(dataLocal && dataLocal.length){
    filterTagsData = filterTagsModule.query[dataLocal].tags;
    }
    if(filterTagsData.length > 1) {
    %>
    <div class="kuFilterTagsContainer">
        <% helper.each(filterTagsData, function(key,item) {
        var filterTagItemKey = helper.escapeHTML(item.key);
        var filterTagItemLabel = helper.escapeHTML(helper.translate(item.label));
        if (item.key !== "visible_in_klevu_search") {
        %>
        <span
                class="kuFilterTag"
                data-key="<%= filterTagItemKey %>"
                data-type="<%= helper.escapeHTML(item.type) %>"
        >
                    <span
                            title="<%= filterTagItemLabel %>"
                            data-value="<%= filterTagItemLabel %>"
                            class="kuFilterTagKey"
                    >
                        <%= helper.translate(item.label) %>
                    </span>
                    <% helper.each(item.values, function(key,option){ %>
                        <% if(item.type === "RATING") { %>
                            <span
                                    title="<%= helper.escapeHTML(helper.translate(option)) %>"
                                    data-value="<%= helper.escapeHTML(helper.translate(option)) %>"
                                    class="kuFilterTagValue">
                                <div class="klevuFacetStars">
                                    <div class="klevuFacetRating" style="width:<%=(20*Number(option))%>%;"></div>
                                </div>
                                <span>&times;</span>
                            </span>
                        <% } else { %>
                            <span
                                    data-value="<%= helper.escapeHTML(helper.translate(option)) %>"
                                    class="kuFilterTagValue"
                                <% if(item.key == "product_depth_layerednav" || item.key == "product_width_layerednav" || item.key == "product_height_layerednav") { %>
                                title="<%= helper.escapeHTML(Number.parseFloat(option)+ "\"") %>">
                                <%= Number.parseFloat(option) %>"
                                <% } else { %>
                                title="<%= helper.escapeHTML(helper.translate(option)) %>">
                                <%= helper.translate(option) %>
                                <% } %>
                                <span>&times;</span>
                            </span>
        <% } %>
        <% }); %>
        </span>
        <% }}); %>
        <span title="<%= helper.translate("Clear all") %>" class="kuFilterTagClearAll"><%= helper.translate("Clear all") %></span>
    </div>
    <% } %>
</script>
<script type="template/klevu" id="klevuLandingTemplateProductBlockOverride">

    <%
    var updatedProductName = dataLocal.name;
    const skuList = dataLocal.sku.split(';');
    const parsedSku = skuList[0];
    if(klevu.search.modules.kmcInputs.base.getSkuOnPageEnableValue()) {
    if(klevu.dom.helpers.cleanUpSku(dataLocal.sku)) {
    updatedProductName += klevu.dom.helpers.cleanUpSku(dataLocal.sku);
    }
    }
    %>
    <li ku-product-block id="klevuProduct-<%=dataLocal.id%>" class="klevuProduct" data-name="<%-dataLocal.name%>" data-sku="<%=dataLocal.sku%>"data-price="<%=dataLocal.price%>" data-customOptions="<%=dataLocal.isCustomOptionsAvailable%>">
        <div class="kuProdWrap">
            <header ku-block data-block-id="ku_landing_result_item_header">
                <%=helper.render('landingProductBadge', scope, data, dataLocal) %>
            </header>
            <% var desc = [dataLocal.summaryAttribute,dataLocal.packageText,dataLocal.summaryDescription].filter(function(el) { return el; }); desc = desc.join(" "); %>
            <main ku-block data-block-id="ku_landing_result_item_info">
                <div class="kuProdTop">
                    <div class="klevuImgWrap">
                        <a data-id="<%=dataLocal.id%>" href="<%=dataLocal.url%>" class="klevuProductClick kuTrackRecentView">
                            <!--                            Adds the outfitters choice badge-->
                            <% if(dataLocal.outfitters_choice_badge == "Yes") { %>
                            <div class="product-attribute-badges badge-group-media" itemprop="badges">
                                <div id="OCBadge"></div>
                            </div>
                            <% } %>
                            <img src="<%=dataLocal.image%>" origin="<%=dataLocal.image%>" onerror="klevu.dom.helpers.cleanUpProductImage(this)" alt="<%=updatedProductName%>" class="kuProdImg">
                            <%=helper.render('landingImageRollover', scope, data, dataLocal) %>
                        </a>
                    </div>
                    <!-- <div class="kuQuickView">
                        <button data-id="<%=dataLocal.id%>" class="kuBtn kuBtnLight kuQuickViewBtn" role="button" tabindex="0" area-label="">Quick view</button>
                    </div> -->
                </div>
            </main>
            <footer ku-block="" data-block-id="ku_landing_result_item_footer">
                <div class="kuProdSwatchSlider flex items-center glider-contain invisible">
                    <% if(dataLocal.show_swatches_on_plp == "Yes") { %>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="swatch-glider-prev swatch-glider" width="24" height="24" role="img">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        <title>chevron-left</title></svg>
                    <div id="sku-<%=parsedSku%>" class="plp-swatch-slider-container" >
                        <% var config = dataLocal.json_swatch_config ? dataLocal.json_swatch_config : '{}';
                        config = JSON.parse(config);
                        helper.each(config, function(key, item) {
                        %>
                        <% if(item.value !== null && item.value.includes('hex:')) { %>
                        <% let hexColor = item.value.replace('hex:', ''); %>
                        <div data-simple-img="<%=item.plp_img%>" data-option-id="<%=item.option_id%>" style="background-color: <%=hexColor%>" class="plp-color-option-swatch hex-block"></div>
                        <% } else { %>
                        <img data-simple-img="<%=item.plp_img%>" data-option-id="<%=item.option_id%>" class="plp-color-option-swatch" src="<%=item.value%>" alt="swatch"/>
                        <% } %>
                        <% });%>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="swatch-glider-next swatch-glider" width="24" height="24" role="img">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        <title>chevron-right</title></svg>
                    <% } %>
                </div>
                <div class="kuProdBottom">
                    <%
                    var width = Number.parseFloat(dataLocal.product_width_layerednav);
                    var depth = Number.parseFloat(dataLocal.product_depth_layerednav);
                    var height = Number.parseFloat(dataLocal.product_height_layerednav);
                    if(!isNaN(width) && !isNaN(height) && !isNaN(depth)) {
                    %>
                    <div class="kuName kuClippedOne">
                        <p class="dimension height"><span class="label">Height: </span><%=height%>"</p>
                        <p class="dimension width"><span class="label">Width: </span><%=width%>"</p>
                        <p class="dimension depth"><span class="label">Depth: </span><%=depth%>"</p>
                    </div>
                    <% } else { %>
                    <div class="kuName kuClippedOne"><a data-id="<%=dataLocal.id%>" href="<%=dataLocal.url%>" class="klevuProductClick kuTrackRecentView" title="<%= updatedProductName %>"><%= updatedProductName %></a></div>
                    <% } %>
                    <!--                    Calculates the rating and how much of the stars to be colored-->
                    <% if(dataLocal.rating && dataLocal.ratingCount && dataLocal.ratingCount > 0) {
                    let rating = Math.round((dataLocal.rating * 100) / 5) %>
                    <div class="product-reviews-summary short flex">
                        <div class="rating-summary">
                            <div class="rating-result flex items-center"
                                 id="rating-result_test"
                                 title="<%=rating%>%">
                                <span style="width: <%=rating%>%;"><span><%=rating%>%</span></span>
                            </div>
                        </div>
                        <div class="reviews-actions">
                            <a class="action view" href="<%=dataLocal.url + '#reviews'%>">
                                <!--                                Displays the number of reviews-->
                                <%= Math.floor(dataLocal.ratingCount) %> <span class="max-sm:hidden">
                                    <% if(Math.floor(dataLocal.ratingCount) == 1) { %>
                                    Review
                                    <% } else { %>
                                    Reviews
                                    <% } %>
                                </span>
                            </a>
                        </div>
                    </div>
                    <% } %>


                    <% if(dataLocal.inStock && dataLocal.inStock != "yes") { %>
                    <%=helper.render('landingProductStock', scope, data, dataLocal) %>
                    <% } else { %>
                    <% if(klevu.search.modules.kmcInputs.base.getShowPrices()) { %>
                    <div class="kuPrice">
                        <%
                        var kuTotalVariants = klevu.dom.helpers.cleanUpPriceValue(dataLocal.totalVariants);
                        var kuStartPrice = klevu.dom.helpers.cleanUpPriceValue(dataLocal.startPrice,dataLocal.currency);
                        var kuSalePrice = klevu.dom.helpers.cleanUpPriceValue(dataLocal.salePrice,dataLocal.currency);
                        var kuPrice = klevu.dom.helpers.cleanUpPriceValue(dataLocal.price,dataLocal.currency);
                        %>
                        <% if(!Number.isNaN(kuTotalVariants) && !Number.isNaN(kuStartPrice) && parseFloat(dataLocal.startPrice) > 0) { %>
                        <div class="kuSalePrice kuStartPrice kuClippedOne">
                            <span><%=helper.processCurrency(dataLocal.currency,parseFloat(dataLocal.startPrice))%></span>
                        </div>
                        <% } else if(!Number.isNaN(kuSalePrice) && !Number.isNaN(kuPrice) && (kuPrice > kuSalePrice) && kuSalePrice > 0){ %>
                        <span class="kuOrigPrice kuClippedOne">
                                    <%= helper.processCurrency(dataLocal.currency,parseFloat(dataLocal.price)) %>
                                </span>
                        <span class="kuSalePrice kuSpecialPrice kuClippedOne">
                                    <%=helper.processCurrency(dataLocal.currency,parseFloat(dataLocal.salePrice))%>
                                </span>
                        <% } else if(!Number.isNaN(kuSalePrice) && kuSalePrice > 0) { %>
                        <span class="kuSalePrice kuSpecialPrice">
                                    <%= helper.processCurrency(dataLocal.currency,parseFloat(dataLocal.salePrice)) %>
                                </span>
                        <% } else if(!Number.isNaN(kuPrice) && kuPrice > 0) { %>
                        <span class="kuSalePrice">
                                    <%= helper.processCurrency(dataLocal.currency,parseFloat(dataLocal.price)) %>
                                </span>
                        <% } %>
                        <%=helper.render('searchResultProductVATLabel', scope, data, dataLocal) %>
                    </div>
                    <% } %>
                    <% } %>
                </div>
                <div class="kuProdAdditional <%if (dataLocal.rating && dataLocal.ratingCount && dataLocal.ratingCount > 0) { %>hasReviews<% } %>">
                    <div class="kuProdAdditionalData">
                        <% if(desc && desc.length) { %>
                        <div class="kuDesc kuClippedTwo"> <%=desc%> </div>
                        <% } %>
                        <%=helper.render('landingProductSwatch',scope,data,dataLocal) %>
                        <% var isAddToCartEnabled = klevu.search.modules.kmcInputs.base.getAddToCartEnableValue(); %>
                        <% if(isAddToCartEnabled) { %>
                        <%=helper.render('landingPageProductAddToCart',scope,data,dataLocal) %>
                        <% } %>
                    </div>
                </div>
            </footer>
        </div>
    </li>

</script>
<script>
    const hoverClass = 'last-hover';

    const containerClass = '.plp-swatch-slider-container';

    const swatchImgSelector = 'img.plp-color-option-swatch';

    const swatchHexSelector = '.plp-color-option-swatch.hex-block';

    const plpProdContainer = '.klevuProduct';

    const pdpLinkContainerSelector = '.klevuImgWrap a';

    const pdpImgContainerSelector = '.klevuImgWrap a img.kuProdImg';

    const addToCartSelector = '.kuAddtocart a';

    const colorSwatch = 'color_swatch';

    function processUrl(url, swatchOptionId) {
        const urlParts = url.split('?');
        let searchParams = (urlParts.length > 1) ? new URLSearchParams(urlParts[1]) : new URLSearchParams();

        if(searchParams.has(colorSwatch)) {
            searchParams.delete(colorSwatch);
        }
        searchParams.append(colorSwatch, swatchOptionId)
        const queryStr = searchParams.toString();
        return urlParts[0] + '?' + queryStr;
    }

    function updateClass($swatch) {
        const $parentContainer = $swatch.closest(containerClass);
        $parentContainer.querySelectorAll(swatchImgSelector).forEach(function(elem) { elem.classList.remove(hoverClass) });
        $parentContainer.querySelectorAll(swatchHexSelector).forEach(function(elem) { elem.classList.remove(hoverClass) });
        if($swatch.matches('img')) {
            $swatch.classList.add(hoverClass);
        } else if($swatch.matches('.hex-block')) {
            $swatch.classList.add(hoverClass);
        }

    }

    function updateUrl($swatch) {
        const swatchOptionId = $swatch.dataset.optionId;
        const $parentContainer = $swatch.closest(plpProdContainer);
        let url = $parentContainer.querySelector(pdpLinkContainerSelector).href;
        if(typeof url === 'undefined' || !url) {
            return;
        }
        url = processUrl(url, swatchOptionId);
        $parentContainer.querySelector(pdpLinkContainerSelector).setAttribute('href', url);
        const atcBtn = $parentContainer.querySelector(addToCartSelector);
        if(atcBtn) {
            atcBtn.setAttribute('href', url);
        }
    }

    function updateImg($swatch) {
        let simpleImg = $swatch.dataset.simpleImg;
        const $parentContainer = $swatch.closest(plpProdContainer);
        const $imgContainer = $parentContainer.querySelector(pdpImgContainerSelector);
        simpleImg = simpleImg.replace('needtochange/', '');
        $imgContainer.setAttribute('src', simpleImg);
    }

    function swatchHoverAction () {
        const elem = this;
        updateImg(elem);
        updateClass(elem);
        updateUrl(elem);
    }


    function loadScript() {
        const swatchSliders = document.querySelectorAll(
            '.plp-swatch-slider-container'
        );

        if (swatchSliders.length > 0) {
            const script = document.createElement('script');
            script.type = 'text/javascript';

            script.addEventListener('load', () => {
                initializeKlevuSliders(swatchSliders);
            });

            script.src = 'https\u003A\u002F\u002Fstaging.boatoutfitters.com\u002Fstatic\u002Fversion1730816576\u002Ffrontend\u002FKadro\u002Fboat_outfitters_hyva\u002Fen_US\u002FMagento_PageBuilder\u002Fjs\u002Fglider.min.js';
            document.head.appendChild(script);
        }
    }

    function prepareDisabledNavArrows(arrows, flexBasis) {
        arrows.forEach((arrow=>{
            arrow.classList.add('invisible');
            arrow.style.flexBasis = flexBasis.toString() + '%';
        }));
    }

    /**
     *
     * @param slidesToShow
     * @param arrows
     * @returns {{scrollLock: boolean, slidesToScroll: number, slidesToShow: number}}
     */
    function buildGliderOptions(slidesToShow, arrows) {
        let gliderOptions = {
            slidesToShow: Math.min(slidesToShow, 4),
            slidesToScroll: 1,
            scrollLock: true,
            duration: 2
        }
        gliderOptions.arrows = (slidesToShow > 4) ? arrows : undefined;
        return gliderOptions;
    }

    /**
     *
     * @param elem for glider
     */
    function initializeGlider(elem) {
        const swatchCount = elem.querySelectorAll('.plp-color-option-swatch').length;
        const parentContain = elem.parentElement;
        const arrows = {prev:parentContain.querySelector('.swatch-glider-prev'), next: parentContain.querySelector('.swatch-glider-next')};
        let gliderOptions = buildGliderOptions(swatchCount, arrows);
        if(!gliderOptions.arrows) {
            const newPercent = (swatchCount / 4.0) * 80;
            const flexBasis = (100 - newPercent) / 2.0;
            elem.style.width = newPercent.toString() + '%';
            prepareDisabledNavArrows(Object.values(arrows), flexBasis);
        }
        parentContain.classList.remove('invisible');
        new Glider(elem, gliderOptions);
    }

    function initializeKlevuSliders(swatchSliders)
    {
        if(Glider) {
            swatchSliders.forEach(function(elem){
                initializeGlider(elem)
            });
        }
    }

    function initializeHoverActions() {
        document.querySelectorAll('.plp-color-option-swatch').forEach(function(elem){
            elem.addEventListener('mouseenter', swatchHoverAction)
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        document.addEventListener("klevuLoaded", function () {
            loadScript();
            initializeHoverActions();
        });
    })


</script>
<script type="template/klevu" id="klevuQuickTemplateFiltersOverride">
    <% if(data.query[dataLocal].filters.length > 0 ) { %>
    <button id="kuFilterOpener">Filter<span class="filter-icon ml-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="text-white px-1 rotate-0" width="24" height="24" role="img">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
<title>chevron-down</title></svg>
</span></button>
    <div class="kuFilters" role="navigation" data-position="left" aria-label="Product Filters" tabindex="0">
        <% helper.each(data.query[dataLocal].filters,function(key,filter){ %>
        <% if(window.innerWidth < 768) filter.isCollapsed = true; %>
        <% if(filter.type == "OPTIONS"){ %>
        <div class="kuFilterBox klevuFilter <%=(filter.multiselect)?'kuMulticheck':''%>" data-filter="<%=filter.key%>" <% if(filter.multiselect){ %> data-singleselect="false" <% } else { %> data-singleselect="true"<% } %>>
        <div class="kuFilterHead <%=(filter.isCollapsed) ? 'kuExpand' : 'kuCollapse'%>">
            <% var filter_label = (filter.label=="klevu_price") ? "price" : filter.label; %>
            <%=helper.translate(filter_label)%>
        </div>
        <div data-optionCount="<%= filter.options.length %>" class="kuFilterNames <%= (filter.options.length < 5 && !filter.isCollapsed) ? 'kuFilterShowAll': '' %> <%=(filter.isCollapsed) ? 'kuFilterCollapse' : ''%>">
            <ul>
                <% helper.each(filter.options,function(key,filterOption){ %>
                <li <% if(filterOption.selected ==true) { %> class="kuSelected"<% } %>>
                <a
                        target="_self"
                        href="#"
                        title="<%=helper.escapeHTML(filterOption.name)%>"
                        class="klevuFilterOption<% if(filterOption.selected ==true) { %> klevuFilterOptionActive<% } %>"
                        data-value="<%=helper.escapeHTML(filterOption.value)%>"
                        data-name="<%=helper.escapeHTML(filterOption.name)%>"
                >
                    <span class="kuFilterIcon"></span>
                    <span class="kufacet-text"><%=filterOption.name%></span>
                    <% if(filterOption.selected ==true) { %>
                    <span class="kuFilterCancel">X</span>
                    <% } else { %>
                    <span class="kuFilterTotal"><%=filterOption.count%></span>
                    <% } %>
                </a>
                </li>
                <%  }); %>
            </ul>
            <% if(filter.options.length > 5 ) { %>
            <div class="kuShowOpt" tabindex="-1">
                <span class="kuFilterDot"></span><span class="kuFilterDot"></span><span class="kuFilterDot"></span>
            </div>
            <% } %>
        </div>
    </div>
    <% } else if(filter.type == "SLIDER")  { %>
    <div class="kuFilterBox klevuFilter" data-filter="<%=filter.key%>">
        <div class="kuFilterHead <%=(filter.isCollapsed) ? 'kuExpand' : 'kuCollapse'%>">
            <% var filter_label = (filter.label=="klevu_price") ? "price" : filter.label; %>
            <%=helper.translate(filter_label)%>
        </div>
        <div class="kuFilterNames sliderFilterNames <%=(filter.isCollapsed) ? 'kuFilterCollapse' : ''%>">
            <div class="kuPriceSlider klevuSliderFilter" data-query = "<%=dataLocal%>">
                <div data-querykey = "<%=dataLocal%>" class="noUi-target noUi-ltr noUi-horizontal noUi-background kuSliderFilter kuPriceRangeSliderFilter<%=dataLocal%>"></div>
            </div>
        </div>
    </div>
    <% } else if (filter.type == "RATING")  { %>
    <div class="kuFilterBox klevuFilter <%=(filter.multiselect)?'kuMulticheck':''%>" data-filter="<%=filter.key%>" <% if(filter.multiselect){ %> data-singleselect="false" <% } else { %> data-singleselect="true"<% } %>>
    <div class="kuFilterHead <%=(filter.isCollapsed) ? 'kuExpand' : 'kuCollapse'%>">
        <%=helper.translate(filter.label)%>
    </div>
    <div data-optionCount="<%= filter.options.length %>" class="kuFilterNames <%= (filter.options.length < 5 ) ? 'kuFilterShowAll': '' %> <%=(filter.isCollapsed) ? 'kuFilterCollapse' : ''%>">
        <ul>
            <% helper.each(filter.options,function(key,filterOption){ %>
            <li <% if(filterOption.selected ==true) { %> class="kuSelected"<% } %>>
            <a
                    target="_self"
                    href="#"
                    title="<%=helper.escapeHTML(filterOption.name)%>"
                    class="klevuFilterOption<% if(filterOption.selected ==true) { %> klevuFilterOptionActive<% } %>"
                    data-value="<%=helper.escapeHTML(filterOption.value)%>"
                    data-name="<%=helper.escapeHTML(filterOption.name)%>"
            >
                <span class="kuFilterIcon"></span>
                <span class="kufacet-text">
                                                <div class="klevuFacetStars">
                                                    <div class="klevuFacetRating" style="width:<%=(20*Number(filterOption.name))%>%;"></div>
                                                </div>
                                            </span>
                <% if(filterOption.selected ==true) { %>
                <span class="kuFilterCancel">X</span>
                <% } else { %>
                <span class="kuFilterTotal"><%=filterOption.count%></span>
                <% } %>
            </a>
            </li>
            <%  }); %>
        </ul>
    </div>
    </div>
    <% } else { %>
    <!-- Other Facets -->
    <% } %>
    <% }); %>
    <!-- <div class="kuFiltersFooter">
        <a target="_self" href="javascript:void(0)" class="kuBtn kuFacetsSlideOut kuMobileFilterCloseBtn" role="button" tabindex="0" area-label=""><%=helper.translate("Close")%></a>
      </div> -->
    </div>
    <% } %>
</script>
<script type="template/klevu" id="klevuResultsPagePersonalizations">
    <div class="kuResultsListing">
        <div class="productList klevuMeta" data-section="productList">
            <div class="kuResultContent">
                <div class="kuResultWrap <%=(data.query.productList.filters.length == 0 )?'kuBlockFullwidth':''%>">

                    <div ku-container data-container-id="ku_landing_main_content_container" data-container-role="content">
                        <section ku-container data-container-id="ku_landing_main_content_left" data-container-position="left" data-container-role="left">
                            <div ku-block data-block-id="ku_landing_left_facets">
                                <%=helper.render('filters',scope,data,"productList") %>
                            </div>
                            <div ku-block data-block-id="ku_landing_left_call_outs"></div>
                            <div ku-block data-block-id="ku_landing_left_banner"></div>
                        </section>
                        <section ku-container data-container-id="ku_landing_main_content_center" data-container-position="center" data-container-role="center">

                            <header ku-block data-block-id="ku_landing_result_header">
                                <%=helper.render('klevuLandingTemplateResultsHeadingTitle',scope,data,"productList") %>
                                <%=helper.render('filtersTop',scope,data,"productList") %>
                                <%= helper.render('kuFilterTagsTemplate',scope,data,"productList") %>
                                <% if(helper.hasResults(data,"productList")) { %>
                                <%=helper.render('sortBy',scope,data,"productList") %>
                                <%=helper.render('limit',scope,data,"productList") %>
                                <%=helper.render('kuTemplateLandingResultsViewSwitch',scope,data,"productList") %>
                                <% } %>
                                <div class="kuClearBoth"></div>
                            </header>

                            <div ku-block data-block-id="ku_landing_result_items">
                                <div class="kuResults">
                                    <% if(helper.hasResults(data,"productList")) { %>
                                    <ul>
                                        <% helper.each(data.query.productList.result,function(key,item){ %>
                                        <% if(item.typeOfRecord == "KLEVU_PRODUCT") { %>
                                        <%=helper.render('productBlock',scope,data,item) %>
                                        <% } %>
                                        <% }); %>
                                    </ul>
                                    <% } else { %>
                                    <div class="kuNoRecordsFoundLabelTextContainer">
                                        <span class="kuNoRecordsFoundLabelText"><%= helper.translate("No records found for your selection") %></span>
                                    </div>
                                    <% } %>
                                    <div class="kuClearBoth"></div>
                                </div>
                            </div>

                            <div ku-block data-block-id="ku_landing_other_items">
                                <%=helper.render('klevuLandingTemplateInfiniteScrollDown',scope,data) %>
                            </div>
                            <%=helper.render('pagination',scope,data,"productList") %>
                            <footer ku-block data-block-id="ku_landing_result_footer"></footer>
                        </section>
                        <section ku-container data-container-id="ku_landing_main_content_right" data-container-position="right" data-container-role="right">
                            <div ku-block data-block-id="ku_landing_right_facets"></div>
                            <div ku-block data-block-id="ku_landing_right_call_outs"></div>
                            <div ku-block data-block-id="ku_landing_right_banner"></div>
                        </section>
                    </div>

                </div>
            </div>
        </div>

        <% if(data.query.contentList) { %>
        <div class="contentList klevuMeta" data-section="contentList" data-result-view="list">
            <div class="kuResultContent">
                <div class="kuResultWrap <%=(data.query.contentList.filters.length == 0 )?'kuBlockFullwidth':''%>">

                    <div ku-container data-container-id="ku_landing_main_content_container" data-container-role="content">
                        <section ku-container data-container-id="ku_landing_main_content_left" data-container-position="left" data-container-role="left">
                            <div ku-block data-block-id="ku_landing_left_facets">

                                <%=helper.render('filters',scope,data,"contentList") %>

                            </div>
                            <div ku-block data-block-id="ku_landing_left_call_outs"></div>
                            <div ku-block data-block-id="ku_landing_left_banner"></div>
                        </section>
                        <section ku-container data-container-id="ku_landing_main_content_center" data-container-position="center" data-container-role="center">

                            <header ku-block data-block-id="ku_landing_result_header">
                                <%=helper.render('filtersTop',scope,data,"contentList") %>
                                <%= helper.render('kuFilterTagsTemplate',scope,data,"contentList") %>
                                <% if(helper.hasResults(data,"contentList")) { %>
                                <%=helper.render('limit',scope,data,"contentList") %>
                                <% } %>
                                <div class="kuClearBoth"></div>
                            </header>

                            <div ku-block data-block-id="ku_landing_result_items">
                                <div class="kuClearBoth"></div>
                                <div class="kuResults">
                                    <% if(helper.hasResults(data,"contentList")) { %>
                                    <ul>
                                        <% helper.each(data.query.contentList.result,function(key,item){ %>
                                        <% if(item.typeOfRecord == "KLEVU_CMS") { %>
                                        <%=helper.render('contentBlock',scope,data,item) %>
                                        <% }%>
                                        <% }); %>
                                    </ul>
                                    <% } else { %>
                                    <div class="kuNoRecordsFoundLabelTextContainer">
                                        <span class="kuNoRecordsFoundLabelText"><%= helper.translate("No records found for your selection") %></span>
                                    </div>
                                    <% } %>
                                    <div class="kuClearBoth"></div>
                                </div>
                            </div>
                            <div ku-block data-block-id="ku_landing_other_items">
                                <%=helper.render('klevuLandingTemplateInfiniteScrollDown',scope,data) %>
                            </div>
                            <%=helper.render('pagination',scope,data,"contentList") %>
                            <footer ku-block data-block-id="ku_landing_result_footer"></footer>
                        </section>
                        <section ku-container data-container-id="ku_landing_main_content_right" data-container-position="right" data-container-role="right">
                            <div ku-block data-block-id="ku_landing_right_facets"></div>
                            <div ku-block data-block-id="ku_landing_right_call_outs"></div>
                            <div ku-block data-block-id="ku_landing_right_banner"></div>
                        </section>
                    </div>

                </div>
            </div>
        </div>
        <% } %>

    </div>
</script>
<script type="template/klevu" id="klevuQuickTemplateBase_showPersonalizations">
    <div class="klevu-fluid kuPreventDocumentClick">
        <div id="klevuSearchingArea" class="klevuQuickSearchingArea">
            <div ku-container data-container-id="ku_quick_main_container" data-container-role="main">
                <header ku-container data-container-id="ku_quick_main_header_container" data-container-role="header">
                    <section ku-block data-block-id="ku_quick_main_header_sub_panel"></section>
                    <section ku-block data-block-id="ku_quick_main_header_banner">
                        <%=helper.render('klevuQuickPromotionBanner',scope,data,"top") %>
                    </section>
                </header>


                <% if(data.showQuickFacetedLayoutCharLimitMessage == true) { %>
                <% var quickFacetedLayoutMessage = (data.quickFacetedLayoutMinCharsTextValue) ? data.quickFacetedLayoutMinCharsTextValue : ""; %>
                <% if(quickFacetedLayoutMessage != "") { %>
                <span class="kuFacetedLayoutMinCharText"><%= helper.translate(quickFacetedLayoutMessage) %></span>
                <% } %>
                <% } else { %>
                <!-- Kadro: removed else statement preventing personalizations from showing if
                        product list was present-->
                <div class="kuSearchPersonalizationsContainer">
                    <%= helper.render('klevuSearchPersonalizations',scope) %>
                </div>
                <% } %>

                <footer ku-container data-container-id="ku_quick_main_footer_container" data-container-role="footer">
                    <section ku-block data-block-id="ku_quick_main_footer_sub_panel"></section>
                    <section ku-block data-block-id="ku_quick_main_footer_banner">
                        <%= helper.render('klevuQuickPromotionBanner',scope,data,"bottom") %>
                    </section>
                </footer>
            </div>
        </div>
    </div>
</script>
<!-- Define our own, custom version of the klevuQuickProductBlock template -->
<script type="template/klevu" id="klevuSearchPersonalizations_cmsBlock">
    <div ku-container data-container-id="ku_quick_main_content_container" data-container-role="content">
        <section ku-container data-container-id="ku_quick_main_content_left"
                 data-container-position="left" data-container-role="left">
            <div ku-block data-block-id="ku_quick_left_facets"></div>
            <div ku-block data-block-id="ku_quick_left_call_outs">
                <% if(!data.query.productList) { %>
                <%=helper.render('kuTemplatePopularSearches',scope) %>
                <% } %>
                <%=helper.render('kuTemplateRecentSearches',scope) %>
            </div>
            <div ku-block data-block-id="ku_quick_left_banner"></div>
            <!-- Kadro: moved suggestion section to sidebar -->
            <section ku-block data-block-id="ku_quick_main_header_site_navigation">
                <div class="klevuSuggestionsBlock">
                    <% if(data.query.productList) { %>
                    <%=helper.render('klevuQuickAutoSuggestions',scope) %>
                    <% } %>
                    <%=helper.render('klevuQuickPageSuggestions',scope) %>
                    <%=helper.render('klevuQuickCategorySuggestions',scope) %>
                </div>
            </section>
            <!-- Kadro: added a point for a CMS block to be injected -->
            <div ku-block class="klevu-cms-block-container">
            </div>
        </section>
        <section ku-container data-container-id="ku_quick_main_content_center"
                 data-container-position="center" data-container-role="center">
            <% if(data.query.productList) { %>
            <%= helper.render('klevuQuickTemplateResultsHeadingTitle',scope,data,"productList") %>
            <%= helper.render('klevuQuickTemplateTabResults',scope) %>
            <%= helper.render('klevuQuickProducts',scope) %>
            <%= helper.render('klevuQuickOtherContent',scope) %>
            <% } else { %>
            <header ku-block data-block-id="ku_quick_result_header"></header>
            <div ku-block data-block-id="ku_quick_result_items"></div>
            <div ku-block data-block-id="ku_quick_other_items">
                <%=helper.render('klevuTrendingProducts',scope) %>
                <%=helper.render('klevuRecentViewedProducts',scope) %>
            </div>
            <footer ku-block data-block-id="ku_quick_result_footer"></footer>
            <% } %>
        </section>
        <section ku-container data-container-id="ku_quick_main_content_bottom_left"
                 data-container-position="left" data-container-role="left">
            <!-- Kadro: added a point for a CMS block to be injected -->
            <div ku-block class="klevu-cms-block-container-mobile">
            </div>
        </section>
        <section ku-container data-container-id="ku_quick_main_content_right"
                 data-container-position="right" data-container-role="right">
            <div ku-block data-block-id="ku_quick_right_facets"></div>
            <div ku-block data-block-id="ku_quick_right_call_outs"></div>
            <div ku-block data-block-id="ku_quick_right_banner"></div>
        </section>
    </div>
</script>
<script type="text&#x2F;javascript">    window.addEventListener('klevu_script_loaded', function() {
    klevu.settings.chains.initChain.add({
        name: "addPriceSuffixToQuickQuery",
        fire: function (data) {
            if (klevu.getObjectPath(klevu.search, "quick", false)
                && klevu.getGlobalSetting("flags.addPriceSuffixToQuery.quick", false)
                && typeof window.klevu_addPriceSuffixToQueryControl === "object"
            ) {
                klevu.search.quick.getScope().chains.request.control.addAfter('initRequest', window.klevu_addPriceSuffixToQueryControl);
                klevu.setObjectPath(data, "flags.addPriceSuffixToQuery.quick", false);
            }
        }
    });
});

document.addEventListener('klevu.customerData.loadError', function () {
    klevu({ powerUp: { quick: true } });
});
document.addEventListener('klevu.customerData.loaded', function () {
    klevu({
        powerUp: { quick: true },
        flags: {
            addPriceSuffixToQuery: {
                quick: true
            }
        }
    });
});</script>








